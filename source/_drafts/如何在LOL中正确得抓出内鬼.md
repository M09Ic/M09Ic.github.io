---
title: 如何在LOL中正确得抓出内鬼
abbrlink: 29936
tags:
---



原本假期计划是打两个星期游戏再随便折腾点好玩的.但可惜,假期余额不断充值到账,游戏也给我打腻了.于是顺着游戏里小伙伴的撕逼开始了抓内鬼之旅,让👴来看看到底是谁让我上不了王者:D.

## 爬数据

最初打算是使用wegame的查询召唤师接口,但是没找到web端且只记录半年的数据,不方便抓包(懒得用wireshark分析).

然后去翻翻有没有现成的轮子,看到掌萌上已经有人做过类似的工作,还真有.

https://zhuanlan.zhihu.com/p/71549580

脚本都是现成的,但是掌盟只记录了350场,还被无限火力,大乱斗场次给污染了.代码写到一半放弃了.

继续翻着翻着,忘了在哪个论坛找到了英雄联盟官网有详细的对战数据,且不记录大乱斗,无限火力等娱乐模式,只记录匹配,排位与人机,最早的场次记录时间在2018年4月.有一点缺陷是只能看自己的所在的游戏,不能查询其他玩家,那就只能登陆自己和小伙伴的号一个一个来.

QQ的模拟登陆不好做,好在账号就四五个,手动复制Cookie更加方便.

入口找到了.动手抓包.

可以发现它是先请求一次获得全部的比赛记录,再根据需求动态加载具体数据.

`http://lol.sw.game.qq.com/lol/api/?c=Battle&a=matchList&areaId=1&accountId=2944742458&queueId=70,72,73,75,76,78,96,98,100,300,310,313,317,318,325,400,420,430,450,460,600,610,940,950,960,980,990,420,440,470,83,800,810,820,830,840,850&r1=matchList`

![](C:\Users\M09ic-xin\AppData\Roaming\Typora\typora-user-images\image-20200210163557075.png)

这个号一共上千场比赛记录.需要获取其中的gameId参数,拼接到查询具体场次的api中.

`http://lol.sw.game.qq.com/lol/api/?c=Battle&a=combatGains&areaId=1&gameId=4683390105&r1=combatGains`

![image-20200210163820171](C:\Users\M09ic-xin\AppData\Roaming\Typora\typora-user-images\image-20200210163820171.png)

很简单,写个脚本把所有数据都爬了.

稍等几分钟等数据爬完.

其中有很多人机,重开局之类的,判断一下关键参数将其删除.

### 入库

详细数据是一个很大的json,处理起来多有不便,所以把数据入库.也不是所有数据都是需要的,挑比较关键的比如伤害,补刀,击杀等.

当然这里可以选择使用mangodb,这样就不需要麻烦的将数据处理再入库.

方便起见,这里使用的sqlite.具体代码可以去github浏览.

### 分析

经过上面的准备,接下来就是正式的抓内鬼了:D

为了让这个内鬼自己都心服口服,显然需要各种角度的数据对比.

我想到了以下几个数据:

1. 各位置场均伤害 -- 比赛时长 折线图 (伤害)
2. 各位置场均补刀 -- 比赛时长 折线图 (补刀)
3. 失败场次中与对线玩家伤害比 散点图 (养爹值)
4. 胜率场次中与对线玩家伤害比 散点图(CARRY值)
5. 各位置段位 --- 场均伤害 折线图 (判断该玩家大致在哪个段位中)
6. 各位置玩家场均伤害 -- 日期 标准差折线图 (判断游戏水平进步或退步)
7. 各位置场均前十分钟中对线伤害差 (对线能力)
8. 单个英雄场均伤害 -- 比赛时长散点图 (如果内鬼对自己某个英雄自信,可以与平均线对比)

使用python从数据库取出的数据为tuple组成的list,如果把tuple转成list,就是一个二维的list.

数据处理用numpy更加方便,将其二维list转成array,就可以使用各种矩阵的操作快速处理所需的数据.

最后使用pandas绘制表格,matplotlib最终生成png格式的图片.

整个思路很简单,下面来看下结果,让我来康康平时被喷的最多的那位是不是内鬼.



